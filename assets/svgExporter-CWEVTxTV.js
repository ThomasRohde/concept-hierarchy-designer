import{b as O,g as X,C as R,a as I,F as Y}from"./index-C7aJWLsQ.js";const $=(x,b,m,p="Arial")=>{if(typeof document>"u"||!document.createElement){const c=x.split(" "),n=[],A=m*.5,g=Math.floor(b/A);let t="";for(const i of c){const d=t?`${t} ${i}`:i;d.length>g&&t?(n.push(t),t=i):t=d}return t&&n.push(t),n}const E=document.createElement("canvas").getContext("2d");if(!E){const c=x.split(" "),n=[],A=m*.5,g=Math.floor(b/A);let t="";for(const i of c){const d=t?`${t} ${i}`:i;d.length>g&&t?(n.push(t),t=i):t=d}return t&&n.push(t),n}E.font=`${m}px ${p}`;const l=x.split(" "),s=[];let e="";for(const c of l){const n=e?`${e} ${c}`:c;E.measureText(n).width>b&&e?(s.push(e),e=c):e=n}return e&&s.push(e),s},D=x=>{const{text:b,x:m,y:p,width:o,maxHeight:E,fontSize:l,fontWeight:s="normal",fill:e="#000",textAlign:c="left",lineHeight:n=1.2}=x,A=$(b,o-16,l),g=l*n,t=Math.floor(E/g),i=A.slice(0,t);if(A.length>t&&t>0){const S=i[i.length-1],C=$(`${S}...`,o-16,l);i[i.length-1]=C[0]}const d=[];return i.forEach((S,C)=>{const u=document.createElementNS("http://www.w3.org/2000/svg","text");let y=m+8;c==="center"?y=m+o/2:c==="right"&&(y=m+o-8),u.setAttribute("x",y.toString()),u.setAttribute("y",(p+(C+1)*g).toString()),u.setAttribute("font-family","Arial, sans-serif"),u.setAttribute("font-size",l.toString()),u.setAttribute("font-weight",s),u.setAttribute("fill",e),u.setAttribute("text-anchor",c==="center"?"middle":c==="right"?"end":"start"),u.textContent=S,d.push(u)}),d},N=(x,b,m,p,o,E,l,s)=>{const e=document.createElementNS("http://www.w3.org/2000/svg","rect");return e.setAttribute("x",x.toString()),e.setAttribute("y",b.toString()),e.setAttribute("width",m.toString()),e.setAttribute("height",p.toString()),e.setAttribute("rx",o.toString()),e.setAttribute("fill",E),l&&(e.setAttribute("stroke",l),e.setAttribute("stroke-width",s.toString())),e},_=x=>{switch(x){case"current":return{background:"#3B82F6",border:"#2563EB",text:"#FFFFFF",textSecondary:"#DBEAFE"};case"child":return{background:"#F472B6",border:"#EC4899",text:"#FFFFFF",textSecondary:"#FCE7F3"};case"grandchild":return{background:"#4ADE80",border:"#22C55E",text:"#FFFFFF",textSecondary:"#DCFCE7"};default:return{background:"#FFFFFF",border:"#E5E7EB",text:"#000000",textSecondary:"#6B7280"}}},J=async(x,b,m="capability-card")=>{try{const p=O(x),{current:o,kids:E}=X(p,b);if(!o)throw new Error("Current node not found");const l=E.map(r=>({...r,grandchildren:p.children.get(r.id)||[]})),s=R.CARDS_PER_ROW.FIXED_CARD_WIDTH,e=R.SPACING.CARD_GAP,c=R.SPACING.ROW_GAP,n=R.SPACING.CONTAINER_PADDING,A=Math.max(1,l.length),g=A*s+(A-1)*e+2*n,t=Math.max(0,...l.map(r=>{var w;return((w=r.grandchildren)==null?void 0:w.length)||0})),i=I("current"),d=I("child"),S=I("grandchild"),C=R.SPACING.GRANDCHILD_ROW_GAP,u=n*2+i+c+d+(t>0?C+t*(S+C):0),y="http://www.w3.org/2000/svg",a=document.createElementNS(y,"svg");a.setAttribute("width",g.toString()),a.setAttribute("height",u.toString()),a.setAttribute("viewBox",`0 0 ${g} ${u}`),a.setAttribute("xmlns",y);let f=n;const T=_("current"),z=N(n,f,g-2*n,i,8,T.background,T.border,2);if(a.appendChild(z),D({text:o.name,x:n,y:f+8,width:g-2*n,maxHeight:30,fontSize:20,fontWeight:"bold",fill:T.text,textAlign:"left"}).forEach(r=>a.appendChild(r)),o.description){const r=o.description.startsWith(o.name)?o.description.substring(o.name.length).trimStart():o.description;D({text:r,x:n,y:f+40,width:g-2*n,maxHeight:i-50,fontSize:14,fill:T.textSecondary,textAlign:"left",lineHeight:1.3}).forEach(F=>a.appendChild(F))}f+=i+c,l.forEach((r,w)=>{const F=n+w*(s+e),h=_("child"),v=N(F,f,s,d,8,h.background,h.border,2);if(a.appendChild(v),D({text:r.name,x:F,y:f+8,width:s,maxHeight:25,fontSize:16,fontWeight:"bold",fill:h.text,textAlign:"left"}).forEach(L=>a.appendChild(L)),r.description){const L=r.description.startsWith(r.name)?r.description.substring(r.name.length).trimStart():r.description;D({text:L,x:F,y:f+35,width:s,maxHeight:d-45,fontSize:12,fill:h.textSecondary,textAlign:"left",lineHeight:1.3}).forEach(W=>a.appendChild(W))}}),f+=d+C;for(let r=0;r<t;r++)l.forEach((w,F)=>{var W;const h=(W=w.grandchildren)==null?void 0:W[r];if(!h)return;const v=n+F*(s+e),H=_("grandchild"),L=N(v,f,s,S,8,H.background,H.border,2);if(a.appendChild(L),D({text:h.name,x:v,y:f+8,width:s,maxHeight:20,fontSize:14,fontWeight:"bold",fill:H.text,textAlign:"left"}).forEach(P=>a.appendChild(P)),h.description){const P=h.description.startsWith(h.name)?h.description.substring(h.name.length).trimStart():h.description;D({text:P,x:v,y:f+28,width:s,maxHeight:S-35,fontSize:11,fill:H.textSecondary,textAlign:"left",lineHeight:1.3}).forEach(M=>a.appendChild(M))}}),f+=S+C;let G=new XMLSerializer().serializeToString(a);G=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
`+G;const B=new Blob([G],{type:"image/svg+xml"});Y.saveAs(B,`${m}.svg`)}catch(p){throw console.error("Failed to export SVG:",p),p}};export{J as exportCapabilityCardAsSvg};
